## Paged List template. Utilizes 'pager' context variable
<div class="form-container" style="width: 100%">
    <h2>#springMessage('content.list.title')</h2>
    #if($pager)
    <table class="table">
        <caption>#springMessage('content.list.table.caption')</caption>
        <thead>
            <tr>
                <th>id</th>
                <th>#springMessage('content.detail.start')</th>
                <th>#springMessage('content.detail.end')</th>
                <th>#springMessage('content.detail.performer')</th>
                <th>#springMessage('content.detail.activity')</th>
            </tr>
        </thead>
        <tbody> current page (-1): ${pager.getPage()} isEmpty()?: ${pager.getPageList().isEmpty()} search ID: $search_id
            #foreach( $report in ${pager.getPageList()} )
            <tr>
                <td>${report.id}</td>
                <td>$datetool.format( 'dd MMM yyyy', ${report.startDate} )</td>
                <td>$datetool.format( 'dd MMM yyyy', $!{report.endDate} )</td>
                <td>${report.performer}</td>
                <td>${report.activity}</td>
            </tr>
            #end
            <div class="button-block clearfix hidden">
                <button class="action" onclick="modal_action()">#springMessage('button.action.get')</button>
                <button class="action update" onclick="modal_update()">#springMessage('button.action.update')</button>          
                <button class="action delete" onclick="modal_delete()">#springMessage('button.action.delete')</button>
            </div>            
        </tbody>
    </table>
    #{else}
        <p>#springMessage</p>
    #end
    
    #if($pager)
        #if($pager.getPageCount() gt 1)
            #pager()    
        #end
    #end
    
    <button class="action add" onclick="modal_add()">#springMessage('content.list.button.addnew')</button>    
    <button class="action" onclick="add_to_watchlist()">#springMessage('content.list.button.addtowatchlist')</button>

</div>


<script type="text/javascript">
#[[  //TODO: l10n
    $(document).ready(function() {
       $(document.createElement("div"))
                .attr("id", "confirm")
                .appendTo($("body"))
                .hide();      
    });

    function add_to_watchlist() {
        var indexes = [];
        $('tr.selected').each( function(index, value) {            
            try {
                indexes.push(parseInt($(value).find('td:first-child').html()));
            } catch (error){
                console.log("Error while parsing ID for a elemend beign selected");
            }
        });    
        if (indexes.length > 0) {
            var url = ]]#"#springUrl('/report/ajax/watch')";#[[
            var indexesData = { "indexes" : indexes };
            $.ajax( url, {
                method: "POST",
                async: true,
                cache: false,
                data: indexesData,
                complete: onWatchComplete,
                dataType: 'text'
            }
            );
        } else {
            $("#confirm").finish().html("Select at least one element. <br />Just click on it")  
                .fadeIn(600)
                .delay(3000)
                .fadeOut(1200);
        }
    };

    function onWatchComplete(xhr, status) {
        if (status === "success") {
            $("#confirm").finish().html("Selected elements has been <br />added to your checklist");
            $(".selected").removeClass("selected").addClass("selected-added");
            //alert(status);
        } else {
            $("#confirm").finish().html("Cannot add selected elements.<br />Please, try later");
            console.log("Cannot fulfil request to the server: " + status);
        }       
        $("#confirm").fadeIn(600)
            .delay(3000)
            .fadeOut(1200);
    }
]]#

    function modal_add() {
        var html = '#modal_add( )';        
        modal.open({ content: html });
        $("#close-btn").click(function() {
            $("#close").click();
        });
    }; 

    function modal_update() {
        var html = '#modal_update( )';        
        modal.open({ content: html });
        $("#close-btn").click(function() {
            $("#close").click();
        });
    };

    function modal_delete() {
        var html = '#modal_delete( )';        
        modal.open({ content: html });
        $("#close-btn").click(function() {
            $("#close").click();
        });
    };

    function modal_action() {
        var html = '#modal_action( )';        
        modal.open({ content: html});
        $("#close-btn").click(function() {
            $("#close").click();
        });
    }; 
</script>    
